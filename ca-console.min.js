/**
* Console AngularJS Module v1.0.0
* https://github.com/albulescu/angular-ca-console
*
* Author Albulescu Cosmin <cosmin@albulescu.ro>
* Licensed under the MIT license.
*/

"use strict";angular.module("ca.console.templates",[]).run(["$templateCache",function(a){a.put("ca-console/directive/console.html",'<div tabindex=-1 class="ca-console ng-cloak" ng-show=visible ng-init=init() ng-style=style><div class=ca-console-header></div><div class=ca-console-body auto-scroll=true><ul><li ng-class=classes[log.type] ng-repeat="log in logs" ng-bind-html=log.body|log></li></ul></div><div class=ca-console-command><input ng-model=expression ng-keydown=commandKeyDown($event)></div><div class=ca-console-move title="Move console"></div><div class=ca-console-close title="Close console" ng-click=console.hide()></div><div class=ca-console-resize title="Resize console"></div></div>')}]),angular.module("ca.console",["ca.console.templates"]).constant("DEFAULT_SIZE",[600,250]).provider("$console",function(){var config={};this.overrideBrowserConsole=function(){config.overrideBrowserConsole=!0},this.showPassword=function(a){config.showPassword=a},this.position=function(a){config.position=a},this.appendTo=function(a){config.appendTo=a},this.logLevel=function(a){config.logLevel=a},this.$get=["$rootScope","$timeout","$document","$compile","$http","$templateCache",function($rootScope,$timeout,$document,$compile,$http,$templateCache){function initUI(){function a(a){instance.resize(g+(a.screenX-i),h+(a.screenY-j)),scope.$emit("resize"),messagesListElement[0].scrollTop=messagesListElement[0].scrollHeight}function b(){$document.off("mousemove",a),$document.off("mouseup",b)}function c(a){l=a.screenY-f,k=a.screenX-e,element.css({top:l+"px",left:k+"px"}),scope.$emit("move",k,l)}function d(){$document.off("mousemove",c),$document.off("mouseup",d),scope.$emit("move.complete")}var e=element.offset().left,f=element.offset().top,g=element.width(),h=element.height(),i=0,j=0,k=e,l=f;element.find(".ca-console-move").on("mousedown",function(a){a.preventDefault(),e=a.screenX-k,f=a.screenY-l,$document.on("mousemove",c),$document.on("mouseup",d),scope.$emit("move.start")}),element.find(".ca-console-resize").on("mousedown",function(c){c.preventDefault(),g=element.width(),h=element.height(),i=c.screenX,j=c.screenY,$document.on("mousemove",a),$document.on("mouseup",b),scope.$emit("resize.start")})}function createUI(){$http.get("ca-console/directive/console.html",{cache:$templateCache}).success(function(a){element=angular.element(a),messagesListElement=element.find(".ca-console-body"),angular.element("body").append(element),$compile(element)(scope),initUI()})}function flaged(a,b){return b===(a&b)}function flag(a,b,c){if(c){if((a&b)===b)return a;a|=b}else{if(0===(a&b))return a;a&=~b}return a}function wrapLog(a){return function(){var b=Array.prototype.slice.call(arguments);scope.logs.push({body:b,type:a,time:(new Date).getTime()})}}function commandParams(a){var b=commands[a];if(angular.isUndefined(b))throw new Error('Command "'+name+'" is not registered');return b.toString().slice(b.toString().indexOf("(")+1,b.toString().indexOf(")")).match(/([^\s,]+)/g)}function evalCommandLine(expression){var matches=expression.match(/^(:[a-zA-Z-_]*)(.*)?$/);if(!matches)throw new Error('Invalid expression "'+expression+'"');for(var command=matches[1],paramsExp=(matches[2]||"").trim(),inString=!1,capture=!0,group=[],param="",params=[],i=0;i<paramsExp.length;i++){var c=paramsExp[i];if(('"'===c||"'"===c)&&(inString=!inString),","===c&&!inString){if(capture&&0===group.length)throw new Error("Invalid expression. Please remove comma from index "+i);capture=!capture}if(capture&&" "!==c&&group.push(c),","===c&&!capture&&!inString||i===paramsExp.length-1){try{param=eval(group.join(""))}catch(e){throw new Error('Invalid parameter "'+group.join("")+'"')}params.push(param),group=[],capture=!0}}return params.unshift(command),execCommand.apply(null,params)}function execCommand(){if(0===arguments.length)throw new Error("ecnr");var a=Array.prototype.slice.call(arguments),b=a.shift().substring(1);if(!angular.isFunction(commands[b]))throw new Error('Command "'+b+"("+a.join(", ")+')" not found!');var c=commands[b],d=commandParams(b);if(d&&d.length>a.length)throw new Error('Invalid arguments length. Command "'+b+'" has '+d.length+" params");return c.apply(instance,a)}var Opt={HIDE_ON_BLUR:"hideOnBlur",USE_ANIMATIONS:"useAnimations",LOG_NORMAL:1,LOG_INFO:2,LOG_DEBUG:4,LOG_WARN:8,LOG_ERROR:16,LOG_ALL:32},scope=$rootScope.$new(!0),element=null,messagesListElement=null,instance=null,commands={};scope.visible=null,scope.style={},scope.logs=[],scope.expression="",scope.filter="",scope.flags=1,scope.classes={1:"log",2:"info",4:"debug",8:"warn",16:"error"},scope.$watch("visible",function(a){"boolean"!=typeof a||element||createUI()}),scope.commandKeyDown=function(a){if(13===a.keyCode){var b=scope.expression;if(""===b)return;scope.expression="";try{var c=evalCommandLine(b);angular.isDefined(c)&&instance.log(c)}catch(d){instance.error(d)}}};var Console=function(){angular.extend(this,Opt),scope.console=this};Console.prototype.log=function(){element.scope().log.apply(this.element.scope().log,arguments)},Console.prototype.command=function(a,b,c){commands[a]=c?b.bind(c):b},Console.prototype.exec=function(){execCommand.apply(null,arguments)},Console.prototype.hide=function(){scope.visible=!1,scope.$emit("hide")},Console.prototype.show=function(){scope.visible=!0,scope.$emit("hide")},Console.prototype.toggle=function(){scope.visible?scope.hide():scope.show()},Console.prototype.resize=function(a,b){var c=!1;a>400&&(scope.style.width=a,c=!0),b>200&&(scope.style.height=b,c=!0),scope.$emit("resize.complete");try{scope.$digest()}catch(d){}return c},Console.prototype.log=wrapLog(Opt.LOG_NORMAL),Console.prototype.info=wrapLog(Opt.LOG_INFO),Console.prototype.warn=wrapLog(Opt.LOG_WARN),Console.prototype.error=wrapLog(Opt.LOG_ERROR),Console.prototype.on=function(a,b){return scope.$on(a,b)},Console.prototype.emit=function(){return scope.$emit.apply(scope,arguments)};var clearPasswordInterval,passwordChars=[];return angular.element(document).keypress(function(a){passwordChars.push(String.fromCharCode(a.keyCode)),passwordChars.join("")===config.showPassword&&scope.show(),$timeout.cancel(clearPasswordInterval),clearPasswordInterval=$timeout(function(){passwordChars=[]},3e3)}),instance=new Console,instance.command("level",function(a){instance.log("Set log level to "+a)}),instance.command("hide",function(){instance.hide()}),instance.command("commands",function(){var a="";for(var b in commands){var c=commandParams(b)||[];a+=b+"("+c.join(",")+")\n"}return a}),instance.command("resize",function(a,b){this.resize(a,b)&&this.log("Resized to "+a+"x"+b)}),config.overrideBrowserConsole&&(console.log=instance.log,console.info=instance.info,console.debug=instance.debug,console.error=instance.error,console.warn=instance.warn),config.logLevel&&(scope.flags=config.logLevel),instance}]}).config(["$sceProvider",function(a){a.enabled(!1)}]),angular.module("ca.console").directive("autoScroll",["$timeout","$q","$parse","$log",function(a,b,c,d){return{restrict:"A",link:function(e,f,g){if("auto"!==f.css("overflow"))return d.warn("Element is not scrollable. Auto scroll has no sense!");var h,i=e.$eval(g.autoScroll),j=i||!0,k=function(a){var b=!1;this.target=a,this.preventDefault=function(){b=!0},this.isDefaultPrevented=function(){return b}};e.$on("$enableAutoScroll",function(){j||d.info("Enable autoscroll"),j=!0}),e.$on("$disableAutoScroll",function(){j&&d.info("Disable autoscroll"),j=!1}),f.on("wheel",function(a){var b=a.originalEvent.detail?-120*a.originalEvent.detail:a.originalEvent.wheelDelta;return b>0?void(j=!1):void(f.get(0).scrollTop>=f.get(0).scrollHeight-f.height()&&(j=!0))}),f.on("DOMNodeInserted",function(d){var l=d.srcElement||d.target,m=d.delegateTarget;1===l.nodeType&&j===!0&&i===!0&&(a.cancel(h),h=a(function(){var a=new k(f),d={$event:a},h=c(g.autoScrollTrigger)||angular.noop,i=h(e,d);i&&b.when(i).then(function(){m.scrollTop=m.scrollHeight}),a.isDefaultPrevented()||(m.scrollTop=m.scrollHeight)}))})}}}]),angular.module("ca.console").directive("console",function(){return{restrict:"EA",scope:{name:"@"},controller:"ConsoleController",templateUrl:"ca-console/directive/console.html"}}),angular.module("ca.console").filter("log",["$sce",function(a){var b=function(b){var c="";return c=b instanceof Error?b.stack:angular.isObject(b)?JSON.stringify(b):b,c=c.replace(/(?:\r\n|\r|\n)/g,"<br/>"),c=a.getTrustedUrl(c),c=a.getTrustedHtml(c)};return function(a){return a.map(b).join(",")}}]);